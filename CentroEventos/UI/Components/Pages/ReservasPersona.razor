@page "/mis-reservas/{personaId:int}"
<!-- Cambiar personaId por la manera en la que lo consigas de auth -->
@using Aplicacion.entidades
@inject ListarTodasLasReservas ListarTodasLasReservas
@inject BajaReserva BajaReserva
@inject ModificarReserva ModificarReserva

<h3>Reservas</h3>

<button class="btn btn-primary" @onclick="toggleMios">Ver Mis/Todas las Reservas</button>

@if (reservas == null)
{
    <p>Cargando reservas...</p>
}
else if (!reservas.Any())
{
    <p>No tiene reservas registradas.</p>
}
else
{
    @if (!soloMios)
    {
        <table class="table">
            <thead>
                <tr>
                    <th>Evento</th>
                    <th>Fecha</th>
                    <th>Estado Asistencia</th>
                    <th>Accion</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var reserva in reservas)
            {
                <tr>
                    <td>@(reserva.EventoDeportivo?._nombre ?? "Sin evento")</td>
                    <td>@(reserva.EventoDeportivo?._fechaHoraInicio.ToString("yyyy-MM-dd HH:mm") ?? "-")</td>
                    <td>@(reserva._estadoAsistencia.ToString())</td>
                    <td>
                        <button class="btn btn-primary">Editar</button>
                        <button class="btn btn-danger" @onclick="()=>ConfirmarEliminacion(reserva._id)">Eliminar</button>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    }
    else if (reservasMias != null) 
    {
        <table class="table">
            <thead>
                <tr>
                    <th>Evento</th>
                    <th>Fecha</th>
                    <th>Estado Asistencia</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var reserva in reservasMias)
            {
                <tr>
                    <td>@(reserva.EventoDeportivo?._nombre ?? "Sin evento")</td>
                    <td>@(reserva.EventoDeportivo?._fechaHoraInicio.ToString("yyyy-MM-dd HH:mm") ?? "-")</td>
                    <td>@(reserva._estadoAsistencia.ToString())</td>
                    <td>
                        <button class="btn btn-primary">Editar</button>
                        <button class="btn btn-danger" @onclick="()=>ConfirmarEliminacion(reserva._id)">Eliminar</button>
                    </td>
                </tr>
            }
            </tbody>
        </table> 
    }
}

@code {
    [Parameter]
    public int personaId { get; set; }

    private bool soloMios = false;
    private IEnumerable<Reserva>? reservasMias;
    private IEnumerable<Reserva>? reservas;
    
    private void toggleMios() {
        soloMios = !soloMios;
    }

    private void ConfirmarEliminacion(int resId) {
        BajaReserva.Ejecutar(resId);
    }

    protected override void OnInitialized()
    {
        reservas = ListarTodasLasReservas.Ejecutar();
        reservasMias = reservas.Where(res => res._personaId == personaId).ToList();
    }
}